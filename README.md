# Mewduct Tigerroad

## Synopsis

An extension for tigers who cannot pass through Mewduct.  
It statically generates the `index`, `user`, and `play` pages so that they are fully visible to search engine bots.

## Description

Mewduct Tigerroad, like Mewduct itself, generates files that are statically served by the web server at each step.  
In addition, Tigerroad provides assets that overwrite Mewduct's webroot.

Mewduct Tigerroad operates on the assumption that Mewduct has already generated its output.  
To compare the two: Mewduct generates JSON files, and the HTML loads those JSON files via JavaScript to construct the DOM.  
In contrast, Mewduct Tigerroad loads the JSON files generated by Mewduct and expands them into HTML templates to produce complete pages.

For this reason, the execution order must be:

* Run `mewduct-update.rb` **before** `tigerroad-update.rb`
* Run `mewduct-user.rb` **before** `tigerroad-user.rb`
* Run `mewduct-home.rb` **before** `tigerroad-home.rb`

If you set `TIGERROAD_MODE=1` in Mewduct's zsh configuration file, `mewduct-import.zsh` will automatically run `tigerroad-import.rb`, `tigerroad-user.rb`, and `tigerroad-home.rb`.

Mewduct Tigerroad does not destroy files under Mewduct's webroot.  
With proper server configuration, both Mewduct and Mewduct Tigerroad can be served from the same webroot.

If you want `tigerroad-home.rb` to output `index.html` instead of the default `tigerhome.html`, you can specify it using the environment variable `$TIGERROAD_INDEX_FILENAME`.

## Comparison and Benefits

In general, Mewduct's approach is more compact and easier for administrators to manage.  
It minimizes file duplication and has a clean, elegant design.

The benefits of using Mewduct Tigerroad mainly fall into two categories:

* Improved SEO, increasing the chance that videos appear in search results
* Provides OGP metadata, making video sharing more compatible with social platforms

As secondary benefits, Tigerroad requires fewer requests than Mewduct, offering better performance, and it uses Clean URLs, resulting in more aesthetically pleasing URLs.

In short, Mewduct Tigerroad is tuned primarily for bots.  
If your users are exclusively human, Mewduct alone is generally superior.

And if you truly desire SEO impact, you should use YouTube instead of Mewduct.  
Even with botâ€‘optimized tuning, it is difficult for videos on personal websites to appear in search results.

## Install

All operations are performed within the Mewduct repository:

* `git submodule init`
* `git submodule update`
* Copy the files under `tigerroad/webroot/` into your public webroot

## Update

All operations are performed within the Mewduct repository:

* `git submodule update`
* Copy the files under `tigerroad/webroot/` into your public webroot

## Usage

Normally, in `mewduct-zsh-config.local.zsh`, set:

```zsh
typeset -i TIGERROAD_MODE=1
```

This enables `cli/mewduct-import.zsh` and `migration-cli/update-all.zsh` to trigger Tigerroad generation after their processing.

To call each command directly, use the following format:

```
tigerroad-update.rb <path_to_video_meta.json>
tigerroad-user.rb <path_to_user_dir>
tigerroad-home.rb <path_to_webroot>
```

## Server Configuration

When using Mewduct Tigerroad, server settings differ from those required for Mewduct.

Two key points:

* Treat extensionless files as `text/html`
* In coexistence mode, ensure that access to `/` loads `/tigerhome.html`

### Nginx

```nginx
server {
  #...

  default_type text/html;
  index tigerroad.html

  location = / {
    rewrite ^ /tigerhome.html break;
  }

  location / {
    root /path/to/webroot;
    try_files $uri =404;
  }
}
```

### Caddy

```caddy
example.com {
  root * /path/to/webroot
  file_server

  rewrite / /tigerhome.html

  @no_extension {
    file {
      try_files {path}
    }
    not path *.*
  }
  header @no_extension Content-Type "text/html; charset=utf-8"
}
```

### Lighttpd

```lighttpd
server.module += ("mod_rewrite", "mod_setenv")

url.rewrite-once = ( "^/$" => "/tigerhome.html")
mimetype.assign = (
  "" => "text/html",
  ".mjs" => "application/javascript"
)
include "mime.types.conf"
```
